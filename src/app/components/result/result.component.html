<section class="result-shell" [@resultFade]>
  <div class="result-header" [class.fail]="!isVerified()">
    <p class="eyebrow">Results</p>
    <div class="headline">
      <div class="checkmark" [class.fail]="!isVerified()" aria-hidden="true">
        <svg *ngIf="isVerified(); else failIcon" viewBox="0 0 52 52" role="img">
          <circle cx="26" cy="26" r="25" />
          <path d="M16 27.5l6.2 6.2L36 20.2" />
        </svg>
        <ng-template #failIcon>
          <svg viewBox="0 0 52 52" role="img">
            <circle cx="26" cy="26" r="25" />
            <path d="M17 17l18 18M35 17L17 35" />
          </svg>
        </ng-template>
      </div>
      <div>
        <h1>{{ isVerified() ? 'Verified. You are not a bot.' : 'Verification failed.' }}</h1>
        <p class="lead" *ngIf="isVerified(); else failedMessage">
          Nice work. Your responses are saved in this session. You can start a new run anytime.
        </p>
        <ng-template #failedMessage>
          <p class="lead">
            Your success rate is below {{ minSuccessRate }}%. Please retry to confirm your verification.
          </p>
        </ng-template>
      </div>
    </div>
    <div class="stats">
      <div class="stat-card">
        <p class="stat-label">Success rate</p>
        <p class="stat-value">{{ successRate() }}%</p>
        <div class="stat-bar">
          <span [style.width.%]="successRate()"></span>
        </div>
      </div>
      <div class="stat-card">
        <p class="stat-label">Correct attempts</p>
        <p class="stat-value">{{ correctCount() }}</p>
      </div>
      <div class="stat-card">
        <p class="stat-label">Incorrect attempts</p>
        <p class="stat-value">{{ incorrectCount() }}</p>
      </div>
      <div class="stat-card">
        <p class="stat-label">Total attempts</p>
        <p class="stat-value">{{ totalAttempts() }}</p>
      </div>
    </div>
    <button class="primary" type="button" (click)="startOver()">Start a new challenge</button>
  </div>

  <div class="result-card">
    <h2>Challenge breakdown</h2>
    <div class="result-grid">
      <div class="result-item" *ngFor="let challenge of session().challenges; index as i">
        <p class="label">Stage {{ i + 1 }}</p>
        <p class="prompt">{{ challenge.prompt }}</p>
        <p class="answer">
          <span>Answer:</span>
          {{ formatAnswer(session().progress[challenge.id]?.answer ?? null) }}
        </p>
        <p class="answer">
          <span>Attempts:</span>
          {{ correctAttemptsFor(challenge.id) }} correct /
          {{ incorrectAttemptsFor(challenge.id) }} incorrect
        </p>
        <p class="answer">
          <span>Success rate:</span>
          {{ successRateFor(challenge.id) }}%
        </p>
        <p class="status" [class.pass]="isCorrect(challenge.id)">
          {{ isCorrect(challenge.id) ? 'Passed' : 'Needs review' }}
        </p>
      </div>
    </div>
  </div>
</section>
